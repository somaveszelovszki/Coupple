car.messages=(function(b){var a=sessionStorage.getObject("couple");var c={sendButtonClick:function(){if(a.accessId==="couple"){return}var d=b("#messageTextarea");var f=d.val();if(f.length){var e=new Date().toMySQLDatetimeString();b.post(createURIText("coupple/ajaxCreate/messages"),{data:{text:f,dateTime:e,coupleId:a.id,fromId:a.accessId,toId:(a.accessId===a.person1Id)?a.person2Id:a.person1Id},time:e},function(g){if(g.success){if(g.result&&g.result.length==1){d.val("");messagesUpdater.updateMessagesArea()}else{console.log("Some error has happened during saving message :(")}}else{console.log(g.message?g.message:"Some error has happened during saving message :(")}},"json")}}};return{initialize:function(){messagesUpdater.updateUnreadMessages(true);b("#sendButton").click(c.sendButtonClick);b(window).unload(function(){car.isMessagesTabOpen=false;var d=messagesUpdater.createMessagesObjectForSessionStorage();sessionStorage.setObject("messages",d)})}}})(jQuery);$(document).ready(function(){car.messages.initialize()});